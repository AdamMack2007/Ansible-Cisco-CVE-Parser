# Network CVE Report with Ansible

## Purpose

Creates a report of all CVEs that affect a specific platform (Cisco NXOS, IOS, IOS-XE) based on the version of the software the hosts are running. Simplifies collection and documentation of CVE tracking allowing teams to quickly identify threats to their devices.

## Notes

1. The required variables are found in cve_parser/defaults/main.yml. The required vars will be documented below.
2. This role uses custom filters, these can be found in the filter_plugins directory and are also documented below in the Structure documentation.
3. Confluence is assumed to be the Atlassian hosted solution, you may have to modify the URI call if its an on-premise device.

## Structure

The playbook will perform the following steps:

1. Gather facts on the devices to determine platform and version
2. Filter the host_vars output to find all NXOS, IOS and IOS-XE devices and create a custom data structure. This filter is found in filter_plugins/net_version_mapping.py and an example output file can be found in cve_parser/files/net_version_mapping_example.json
3. Query the Cisco OpenVuln API by first getting an API auth token then looping through the platforms and versions. It will register the output to a variable that will be filtered next.
4. With the variable from the API output, we'll then filter it with the cve_mapping filter to create the data structure. This filter is found in filter_plugins/cve_mapping.py and an example output file can be found in cve_parser/files/cve_mapping_example.json
5. With the data structures from step 2 and step 4, we'll merge the dictionaries to create the cve_data dictionary that we will pass into the jinja2 templates to render the report.
6. From this point we'll either post to Confluence, Mattermost or generate a local HTML report based on the requested action.
7. ???
8. Profit

## Required Variables

There are currently 2 ways to create a report, Mattermost and Confluence. Below are the required variables for each and where they should be placed.

I strongly recommend vaulting the API tokens! In Ansible Tower use a [Custom Credential Type](https://www.ansible.com/blog/ansible-tower-feature-spotlight-custom-credentials).

If you set them as vars it's ideal to remove them from the role, though exta-vars injected at runtime will take precedence over role defaults.

### OS Information

- **ansible_network_os**: Must be either IOS or NXOS, limitation is due to Cisco API platform support.
- **ansible_net_iostype**: Found with fact gathering if its an IOS device.
- **ansible_net_version**: Found with fact gathering

### Cisco PSIRT

For information on the PSIRT OpenVuln API and how to obtain the below variables see ![PSIRT OpenVuln Docs](https://developer.cisco.com/docs/psirt/#!overview)

These two variables are required to get a valid oauth token from the API.

- **cisco_psirt_clientid**: This is the client ID you will receive from Cisco
- **cisco_psirt_clientsecret**: This is the client secret you will receive from Cisco.

### Mattermost

These can be found in defaults/main.yml

- **enable_mattermost**: (yes/no) Includes the Mattermost tasks
- **mattermost_url**: The url for the mattermost instance
- **mattermost_token**: The api token for the mattermost instance
- **mattermost_channel**: The channel to send the message to

### Confluence

These can be found in defaults/main.yml

- **enable_confluence**: (yes/no) Includes the Confluence tasks
- **confluence_url**: Base URL for confluence (myconfluence.atlassian.com)
- **confluence_user**: Username for Confluence
- **confluence_token**: API Token for Confluence
- **confluence_title**: Title of the page to create
- **confluence_space**: This is the space that the page will be created (E.G. Network, Dev, etc)

## Example Output

### Confluence Output

![Example Confluence Report](https://i.imgur.com/2dMU1ox.png)

## Testing
